package Ahorcado.controller;

import Ahorcado.model.*;
import Ahorcado.view.*;

//import java.awt.event.ActionListener;
import java.awt.event.*;
import java.util.ArrayList;

import javax.swing.JOptionPane;

/**
 * 
 * @author Inés Jaso Pernod
 * @author Natalia Tauste Rubio
 */

public class AhorcadoController {
    private AhorcadoModel model;
    private AhorcadoView view;
    private String temaPalabra = "Animales";
    private int tamagnoPalabra = 5;
    private String estiloDibujo = "Clásico";
    private int partidas = 0;
    private String colorAdiv = "Rojo";
    private String colorUtil = "Rojo";

    public AhorcadoController(AhorcadoModel model, AhorcadoView view){
        this.model = model;
        this.view = view;

        view.addWindowListener(new AhorcadoControllerWindowListener());
        view.setActionListener(new AhorcadoControllerActionListener());

        ///< Añadir el "listener" del Slider
    }

    class AhorcadoControllerWindowListener extends WindowAdapter{
        @Override
        public void windowClosing(WindowEvent e){
            System.out.println("AhorcadoController: Cerrar ventana.");
            System.exit(0);
        }
    }

    class AhorcadoControllerActionListener implements ActionListener{
        @Override
        public void actionPerformed(ActionEvent e){
            String command = e.getActionCommand();
            String animales[] = {"OSO", "GATO", "TIGRE", "JIRAFA", "PAJARO", "ELEFANTE"};
            String frutas[] = {"UVA", "PASA", "MANGO", "PAPAYA", "GUAYABO", "MARACUYA"};
            String geografia[] = {"FEZ", "CUBA", "PARIS", "PANAMA", "LETONIA", "PORTUGAL"};

            switch(command){
                case "Salir":
                    System.out.println("AhorcadoController: Salir del juego.");
                    System.exit(0);
                    break;
                case "Ranking": // Comando para mostrar el ranking
                    System.out.println("AhorcadoController: Mostrar ranking.");
                    if(partidas != 0) {
                        view.setVector(model.mostrarRanking(),partidas);
                        view.postRanking();
                        view.repaint();
                        view.rankListener(new AhorcadoControllerActionListener()); //TODO VERIFICAR
                    } else JOptionPane.showMessageDialog(null, 
                        "No hay juegos por mostrar");
                    break;
                case "Reset": // Comando para reiniciar la configuración de partida
                    System.out.println("AhorcadoController: Reiniciar partida.");
                    break;
                case "IrAIni":
                    System.out.println("AhorcadoController: Ir a pantalla de inicio.");
                    view.closeRanking(); ///TODO NO SE SI ES DESDE JUEGOPANEL O DESDE RANKING POR SER EL MENU
                    view.closeJuegoPanel();
                    break;
                case "Nosotras":
                    System.out.println("AhorcadoController: Mostrar información sobre nosotras.");
                    String res = """
                                 Autoras: Inés Jaso Pernod y Natalia Tauste Rubio
                                 
                                 El ahorcado es un juego en el cual un jugador
                                 debe adivinar una palabra escogida por otro
                                 jugador, letra por letra. Si el jugador adivina
                                 una letra que está en la palabra, se revelará
                                 su posición en la palabra. Si la letra no está
                                 en la palabra, se dibujará una parte del
                                 ahorcado. El jugador debe adivinar la palabra
                                 antes de que el dibujo del ahorcado esté completo.
                                 
                                 La pestaña rankings muestra las últimas 10
                                 partidas jugadas, mostrándolas en el orden de la mejor
                                 a la peor partida jugada.
                                  """;
                    JOptionPane.showMessageDialog(null, res);
                    break;
                case "ColoresLetrasAdiv":
                    System.out.println("AhorcadoController: Cambiar colores de letras adivinadas.");
                    colorAdiv = view.getColorLetrasAdiv();
                    break;
                case "ColoresLetrasUtil":
                    System.out.println("AhorcadoController: Cambiar colores de letras utilizadas.");
                    colorUtil = view.getColorLetrasUtil();
                    break;
                case "ComenzarPartida":
                    System.out.println("AhorcadoController: Comenzar partida.");
                    tamagnoPalabra = view.getSlider();
                    String palabra = null;

                    if ("Animales".equals(temaPalabra)) {
                        if (tamagnoPalabra == 3) palabra = animales[0];
                        else if (tamagnoPalabra == 4) palabra = animales[1];
                        else if (tamagnoPalabra == 5) palabra = animales[2];
                        else if (tamagnoPalabra == 6) palabra = animales[3];
                        else if (tamagnoPalabra == 7) palabra = animales[4];
                        else if (tamagnoPalabra == 8) palabra = animales[5];
                    }
                    else if ("Frutas".equals(temaPalabra)) {
                        if (tamagnoPalabra == 3) palabra = frutas[0];
                        else if (tamagnoPalabra == 4) palabra = frutas[1];
                        else if (tamagnoPalabra == 5) palabra = frutas[2];
                        else if (tamagnoPalabra == 6) palabra = frutas[3];
                        else if (tamagnoPalabra == 7) palabra = frutas[4];
                        else if (tamagnoPalabra == 8) palabra = frutas[5];
                    }
                    else if ("Geografía".equals(temaPalabra)) {
                        if (tamagnoPalabra == 3) palabra = geografia[0];
                        else if (tamagnoPalabra == 4) palabra = geografia[1];
                        else if (tamagnoPalabra == 5) palabra = geografia[2];
                        else if (tamagnoPalabra == 6) palabra = geografia[3];
                        else if (tamagnoPalabra == 7) palabra = geografia[4];
                        else if (tamagnoPalabra == 8) palabra = geografia[5];
                    }

                    model = new AhorcadoModel(palabra);
                    view.postJuegoPanel(model, tamagnoPalabra);
                    view.setActionListener(this);
                    break;
                case "EstilosDibujo":
                    System.out.println("AhorcadoController: Cambiar estilo de dibujo.");
                    if (view.getEstiloDibujo().equals("Clásico")){
                        estiloDibujo = "Estilo1";
                    }
                    else if (view.getEstiloDibujo().equals("Peluche")){
                        estiloDibujo = "Estilo2";
                    }
                    else if (view.getEstiloDibujo().equals("Hello Kitty")){
                        estiloDibujo = "Estilo3";
                    }
                    break;
                case "TemasPalabra":
                    System.out.println("AhorcadoController: Cambiar tema de palabra.");
                    if (view.getTemaPalabra().equals("Animales")){
                        temaPalabra = "Animales";
                    }
                    else if (view.getTemaPalabra().equals("Frutas")){
                        temaPalabra = "Frutas";
                    }
                    else if (view.getTemaPalabra().equals("Geografía")){
                        temaPalabra = "Geografía";
                    }
                    break;
                case "AceptarLetra":
                    System.out.println("AhorcadoController: Letra a aceptar.");
                    char letra = view.getLetraIntroducida();
                    boolean acierto = false;

                    // Probar la letra según el estilo de dibujo
                    if(estiloDibujo.equals("Estilo1")){
                        acierto = model.probarLetraEstilo1(letra);
                    }
                    else if(estiloDibujo.equals("Estilo2")){
                        acierto = model.probarLetraEstilo2(letra);
                    }
                    else if(estiloDibujo.equals("Estilo3")){
                        acierto = model.probarLetraEstilo3(letra);
                    }

                    // Mostrar letra con el color correspondiente
                    if(acierto){
                        view.mostrarLetra(letra, colorAdiv);  // color de letra acertada
                    } else {
                        view.mostrarLetra(letra, colorUtil);  // color de letra no acertada
                    }
                    break;
                case "OkRanking":
                    System.out.println("AhorcadoController: Cerrar ranking.");
                    view.closeRanking(); // Vuelve a la pantalla principal
                    view.repaint();
                    break;
                default:
                    System.out.println("AhorcadoController: Comando no reconocido.");
                    break;
            }
        }
    }
}